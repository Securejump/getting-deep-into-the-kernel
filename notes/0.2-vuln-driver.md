# vulnerable driver in drivers/uaf/uaf.c

```
#include<linux/module.h>
#include<linux/init.h>
#include<linux/slab.h>

int use_after_free(void)
{
        char *leak = kzalloc(100, GFP_KERNEL);
        if (!leak)
        {
            printk(KERN_ERR "Memory allocation failed\n");
            goto out;
        }
        strcpy(leak, "This is a use-after-free example");
        kfree(leak);
        // Using the pointer after freeing it, which is undefined behavior
        printk(KERN_INFO "Using freed memory: %s\n", leak); // This is dangerous!
out:
        return 0;
}

void kmod_exit(void)
{
        printk("kmod-hello - module unloaded!\n");
}

module_init(use_after_free);
module_exit(kmod_exit);
```

# creating the drivers/uaf/Kconfig file.

```
config UAF_DRIVER
    bool "UAF test driver"
    default y
    help
      Test driver for fuzzing use-after-free scenariosconfig UAF_DRIVER
```

# creating the drivers/uaf/Makefile

```
obj-$(CONFIG_UAF_DRIVER) += uaf.o
```

Notes: the obj-$(CONFIG_UAF_DRIVER) configuration can be obj-m (loadable module), obj-y (built-in module).

# modifiying the drivers/Kconfig file.

## add this:

```
source "drivers/uaf/Kconfig"
```

adding our driver to drivers/Makefile

```
obj-$(CONFIG_UAF_DRIVER)  += uaf/
```

