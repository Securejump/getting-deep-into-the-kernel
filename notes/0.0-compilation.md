# Tools
Linux Kernel Driver Database
syzkaller

# Compiling
Sources used: 
https://kernelnewbies.org/KernelBuild
https://www.kernel.org/doc/html/v5.0/dev-tools/kgdb.html
https://medium.com/@alessandrozanni.dev/setup-linux-kernel-debugging-with-qemu-and-gdb-e5446c16cd85

```
# when we want to clone our own kernel's configs, use:
cp /boot/config-`uname -r`* .config
# when using default configs, use:
make defconfig
# make the kvm-guest configs
make kvm_guest.config
# use Rostedt's perl script for minimal configs:
perl ktest.pl make_min_config
# for any configuration changes that need to be made:
make menuconfig
# or
make nconfig
# when manual changes are made to .config, run:
make oldconfig
# to update the file accordingly.
# make the scripts_gdb for debugging:
make scripts_gdb
# for the actual compiling, do:
make -j$(nproc)
```

# general debugging

```
CONFIG_PRINTK_TIME - add time stamps to dmesg 
CONFIG_DEBUG_KERNEL - turn on kernel debugging 
CONFIG_DETECT_HUNG_TASK - good for figuring out what's causing a kernel freeze 
CONFIG_DEBUG_INFO - ensures you can decode kernel oops symbols 
CONFIG_EARLY_PRINTK 
CONFIG_LOG_BUF_SHIFT=21 - sets the kernel buffer log size to the biggest buffer
# Coverage collection.
CONFIG_KCOV=y

# disable base randomization
# CONFIG_RANDOMIZE_BASE is not set

# Debug enable
CONFIG_DEBUG_INFO=y

# Debug info for symbolization.
CONFIG_DEBUG_INFO_DWARF4=y

# Memory bug detector
CONFIG_KASAN=y
CONFIG_KASAN_INLINE=y

# Required for Debian Stretch and later
CONFIG_CONFIGFS_FS=y
CONFIG_SECURITYFS=y
``` 

# debugging with kgdb

Kgdb is intended to be used as a source level debugger for the Linux kernel. It is used along with gdb to debug a Linux kernel. The expectation is that gdb can be used to “break in” to the kernel to inspect memory, variables and look through call stack information similar to the way an application developer would use gdb to debug an application. It is possible to place breakpoints in kernel code and perform some limited execution stepping.


- CONFIG_STRICT_KERNEL_RWX is not set - disable strict memory restrictions on RWX ops.
- CONFIG_FRAME_POINTER=y - enable frame pointers, if supported.
- CONFIG_KGDB=y - enable KGDB.
- CONFIG_KGDB_SERIAL_CONSOLE=y - enable KGDB serial console.

# debugging with kdb

Kdb is simplistic shell-style interface which you can use on a system console with a keyboard or serial console. You can use it to inspect memory, registers, process lists, dmesg, and even set breakpoints to stop in a certain location. Kdb is not a source level debugger, although you can set breakpoints and execute some basic kernel run control. Kdb is mainly aimed at doing some analysis to aid in development or diagnosing kernel problems. You can access some symbols by name in kernel built-ins or in kernel modules if the code was built with CONFIG_KALLSYMS.

- CONFIG_STRICT_KERNEL_RWX is not set
- CONFIG_FRAME_POINTER=y
- CONFIG_KGDB=y
- CONFIG_KGDB_SERIAL_CONSOLE=y
- CONFIG_KGDB_KDB=y
- CONFIG_KDB_KEYBOARD=y

# useful kernel parameters

- kgdbwait
- kgdbcon
- echo 1 > /sys/module/kgdb/parameters/kgdb_use_con
- nokaslr

# runtime parameters

- kgdbreboot: The kgdbreboot feature allows you to change how the debugger deals with the reboot notification. You have 3 choices for the behavior. The default behavior is always set to 0.

| id | command                                                 | function                                                   |
| -- | ------------------------------------------------------- | ---------------------------------------------------------- |
| 1	 |  echo -1 > /sys/module/debug_core/parameters/kgdbreboot |	Ignore the reboot notification entirely.                   |
| 2	 |  echo 0 > /sys/module/debug_core/parameters/kgdbreboot  |	Send the detach message to any attached debugger client.   |
| 3	 |  echo 1 > /sys/module/debug_core/parameters/kgdbreboot  |	Enter the debugger on reboot notify.                       |

# scripts_gdb

Sources:
https://www.kernel.org/doc/html/v6.5/dev-tools/gdb-kernel-debugging.html

```
function lx_current -- Return current task
function lx_module -- Find module by name and return the module variable
function lx_per_cpu -- Return per-cpu variable
function lx_task_by_pid -- Find Linux task by PID and return the task_struct variable
function lx_thread_info -- Calculate Linux thread_info from task variable
lx-dmesg -- Print Linux kernel log buffer
lx-lsmod -- List currently loaded modules
lx-symbols -- (Re-)load symbols of Linux kernel and currently loaded modules
```
